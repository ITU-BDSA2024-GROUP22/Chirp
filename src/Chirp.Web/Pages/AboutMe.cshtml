@page "/{author}/about-me"
@using Chirp.Core
@using Microsoft.IdentityModel.Tokens
@model Chirp.Web.Pages.AboutMeModel
@{
    ViewData["Title"] = "Chirp!";
    Layout = "Shared/_Layout";
    var routeName = HttpContext.GetRouteValue("author");
}
<style>
    body {
        background: #deb0c2;
        font-family: 'Trebuchet MS', sans-serif;
        margin: 0;
        padding: 0;
    }

    .user-info {
        max-width: 700px;
        margin: 40px auto;
        background: #eccfdd;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
    }

    .user-info h2 {
        font-size: 24px;
        color: #571010;
        margin-bottom: 20px;
    }

    .user-info img {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        margin-bottom: 20px;
    }

    .user-info form {
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
    }

    .user-info input[type="file"] {
        margin-bottom: 10px;
        padding: 5px;
    }

    .user-info button {
        background: #e896c0;
        border: none;
        border-radius: 7px;
        color: white;
        padding: 10px 20px;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.3s ease;
        margin-bottom: 10px;
    }

    .user-info button:hover {
        background: #d57599;
    }

    .info-box {
        background: #f9f9f9;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        margin-bottom: 15px;
        text-align: center;
    }

    .box-title {
        font-weight: bold;
        font-size: 16px;
        color: #333;
        margin-bottom: 5px;
    }

    .box-content {
        font-size: 14px;
        color: #555;
    }

    .bio-input {
        width: 100%;
        max-width: 400px;
        height: 100px;
        padding: 10px;
        border: 1px solid #e6c0bf;
        border-radius: 7px;
        font-family: 'Trebuchet MS', sans-serif;
        font-size: 14px;
        color: #571010;
    }

    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin-top: 20px;
    }

    .pagination .current-page {
        font-weight: bold;
        color: #571010;
    }

    .pagination a button {
        background: #e896c0;
        border: none;
        border-radius: 7px;
        color: white;
        padding: 8px 16px;
        cursor: pointer;
    }

    .pagination a button:hover {
        background: #d57599;
    }

    .cheeps {
        list-style: none;
        padding: 0;
        margin: 20px 0;
    }

    .cheeps li {
        margin-bottom: 15px;
        background: #f0faf9;
        border: 1px solid #dbf3f1;
        padding: 10px;
        border-radius: 10px;
    }

    .cheeps img {
        float: left;
        margin-right: 10px;
        border-radius: 50%;
        border: 1px solid #ccc;
    }

    .cheeps p {
        margin: 0;
        font-size: 14px;
        color: #555;
    }

    .cheeps small {
        font-size: 12px;
        color: #888;
    }

    .forget-me-submit {
        background: #e48c8c;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 7px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    .forget-me-submit:hover {
        background: #733838;
    }
</style>

@if (User.Identity?.IsAuthenticated == true)
{
    <div class="user-info">
        <h2> User information </h2>
        <br/>
        <div>
            <div>
                <img src="@((await Model.Author).Picture ?? "/images/chirp_silhouette.png")"
                     alt="Profile Picture"
                     style="width: 150px; height: 150px; border-radius: 50%;" />
                <form method="post" enctype="multipart/form-data" asp-page-handler="Picture">
                    @if (!(await Model.Author).Picture.IsNullOrEmpty())
                    {
                    <label for="profilePicture">Change Profile Picture:</label>
                    }
                    else
                    {
                    <label for="profilePicture">Upload Profile Picture:</label>
                    }
                    <input type="file" id="profilePicture" name="profilePicture" accept="image/*"
                           onchange="toggleUploadButton()"/>
                    <button type="submit" id="uploadButton" disabled>Upload</button>
                </form>
            </div>

            <script>
                function toggleUploadButton() {
                    const fileInput = document.getElementById('profilePicture');
                    const uploadButton = document.getElementById('uploadButton');
                    uploadButton.disabled = !fileInput.files.length; // Disable if no file is chosen
                }
            </script>

            <div class="info-box">
                <div class="box-title">Username</div>
                <div class="box-content">
                    @((await Model.Author)?.UserName ?? "Unknown")
                </div>
            </div>
            <br/>
            <div class="info-box">
                <div class="box-title">Email</div>
                <div class="box-content">
                    @((await Model.Author)?.Email ?? "Unknown")
                </div>
            </div>
            <br/>
            <div class="info-box">
                <div class="box-title"></div>
                <form method="post">
                    <textarea asp-for="BioText" class="bio-input" rows="5" placeholder="Write your bio here..."></textarea>
                    <br/>
                    <button type="submit" class="bio-submit">
                        @(string.IsNullOrEmpty(Model.BioText) ? "Save Bio" : "Change Bio")
                    </button>
                </form>
            </div>
            <br/>
            <div class="button">
                <form method="post" asp-page-handler="Forget">
                    <button type="submit" class="forget-me-submit">Forget me!</button>
                </form>
            </div>
        </div>
    </div>

    <div>
        @if ((await Model.Cheeps).Any())
        {
            <ul id="messagelist" class="cheeps">
                @foreach (var cheep in await Model.Cheeps)
                {
                    <li>
                        <p>
                            <img src="@(cheep.Author.Picture ?? "/images/chirp_silhouette.png")" alt="Profile Picture"
                                 style="width: 50px; height: 50px; border-radius: 50%; margin-right: 10px;" />
                            <br/>
                            <strong>
                                <a href="/@cheep.Author.UserName">@cheep.Author.UserName</a>
                            </strong>
                            @cheep.Text
                            <small>&mdash; @cheep.TimeStamp</small>
                        </p>
                    </li>
                }
            </ul>
            if (Model.CheepsCount == 32)
            {
                <div class="pagination" style="display: flex; justify-content: center; align-items: center; margin: 20px 0;">
                    @{
                        int currentPage = Model.CurrentPage;

                        if (currentPage > 1)
                        {
                            <a href="/@routeName/about-me?page=@(currentPage - 1)" class="prev" style="margin-right: 10px;">
                                <button>Previous</button>
                            </a>
                        }

                        <span class="current-page">@currentPage</span>

                        <a href="/@routeName/about-me?page=@(currentPage + 1)" class="next" style="margin-left: 10px;">
                            <button>Next</button>
                        </a>
                    }
                </div>
            }

            else if (Model.CheepsCount < 32 && Model.CheepsCount >= 1)
            {
                <div class="pagination" style="display: flex; justify-content: center; align-items: center; margin: 20px 0;">
                    @{
                        int currentPage = Model.CurrentPage;

                        if (currentPage > 1)
                        {
                            <a href="/@routeName/about-me?page=@(currentPage - 1)" class="prev" style="margin-right: 10px;">
                                <button>Previous</button>
                            </a>
                        }

                        <span class="current-page">@currentPage</span>
                    }
                </div>
            }
        }
        else if (!(await Model.Cheeps).Any() && Model.CurrentPage == 1)
        {
            <em>There are no cheeps so far.</em>
            <div class="pagination" style="display: flex; justify-content: center; align-items: center; margin: 20px 0;">
                @{
                    int currentPage = Model.CurrentPage;
                    <span class="current-page">@currentPage</span>
                }
            </div>
        }
        else
        {
            <em>There are no more cheeps to view.</em>
            <div class="pagination" style="display: flex; justify-content: center; align-items: center; margin: 20px 0;">
                @{
                    int currentPage = Model.CurrentPage;

                    if (currentPage > 1)
                    {
                        <a href="/@routeName/about-me?page=@(currentPage - 1)" class="prev" style="margin-right: 10px;">
                            <button>Previous</button>
                        </a>
                    }

                    <span class="current-page">@currentPage</span>
                }
            </div>
        }
    </div>
}
