@page "/{author}"
@model Chirp.Web.Pages.UserTimelineModel
@{
    ViewData["Title"] = "Chirp!";
    Layout = "Shared/_Layout";
    var routeName = HttpContext.GetRouteValue("author");
}

<div>
    <h2> @((await Model.Author).DisplayName)'s Timeline </h2>

    <div style="border: 2px solid #A54242; padding: 15px; margin: 15px 0; background-color: #f9f9f9; border-radius: 8px; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);">
        <h3 style="margin: 0; margin-bottom: 10px; font-size: 1.2em; color: #333;">
            @((await Model.Author).DisplayName)'s bio
        </h3>
        <p style="margin: 0; font-size: 1em; color: #555; line-height: 1.6;">
            @((await Model.Bio)?.Text ?? "This user has not added a bio yet.")
        </p>
    </div>

    @if ((User.Identity?.IsAuthenticated == true) && (User.Identity?.Name == (await Model.Author).UserName))
    {
        <div class="cheepbox">
            <h3>What's on your mind, @((await Model.Author).DisplayName)?</h3>
            <form method="post">
                <input style="float: left" type="text" asp-for="Text" maxlength="160" id="cheepText" oninput="checkCharacterLimit()" >
                <input type="submit" value="Share">
                <span id="charLimitMessage" style="color: red; display: none; flex: 1"> you can write a maximum of 160 characters... </span>
            </form>
        </div>
        }

        <script>
            function checkCharacterLimit() {
                var cheepInput = document.getElementById("cheepText");
                var message = document.getElementById("charLimitMessage");
                if (cheepInput.value.length >= 160) {
                    message.style.display = "inline";  // Show message
                } else {
                    message.style.display = "none";  // Hide message if under limit
                }
            }
        </script>

        @if ((await Model.Cheeps).Any())
        {
            <ul id="messagelist" class="cheeps">
                @foreach (var cheep in await Model.Cheeps)
                {
                    <li>
                        <p>
                            <strong>
                                <a href="/@cheep.Author.UserName">@cheep.Author.DisplayName</a>
                            </strong>
                            @cheep.Text
                            <small>&mdash; @cheep.TimeStamp</small>
                        </p>
                    </li>
                }
            </ul>
        }
        else
        {
            <em>There are no cheeps so far.</em>
        }

        <div class="pagination" style="display: flex; justify-content: center; align-items: center; margin: 20px 0;">
            @{
                int currentPage = Model.CurrentPage;

                if (currentPage > 1)
                {
                    <a href="/@routeName?page=@(currentPage - 1)" class="prev" style="margin-right: 10px;">
                        <button>Previous</button>
                    </a>
                }

                <span class="current-page">@currentPage</span>

                <a href="/@routeName?page=@(currentPage + 1)" class="next" style="margin-left: 10px;">
                    <button>Next</button>
                </a>
            }
        </div>
</div>
